(function(e){var t=null;e.modal=function(n,r){e.modal.close();var i,s;this.$body=e("body");this.options=e.extend({},e.modal.defaults,r);this.options.doFade=!isNaN(parseInt(this.options.fadeDuration,10));if(n.is("a")){s=n.attr("href");if(/^#/.test(s)){this.$elm=e(s);if(this.$elm.length!==1)return null;this.open()}else{this.$elm=e("<div>");this.$body.append(this.$elm);i=function(e,t){t.elm.remove()};this.showSpinner();n.trigger(e.modal.AJAX_SEND);e.get(s).done(function(r){if(!t)return;n.trigger(e.modal.AJAX_SUCCESS);t.$elm.empty().append(r).on(e.modal.CLOSE,i);t.hideSpinner();t.open();n.trigger(e.modal.AJAX_COMPLETE)}).fail(function(){n.trigger(e.modal.AJAX_FAIL);t.hideSpinner();n.trigger(e.modal.AJAX_COMPLETE)})}}else{this.$elm=n;this.open()}};e.modal.prototype={constructor:e.modal,open:function(){var t=this;if(this.options.doFade){this.block();setTimeout(function(){t.show()},this.options.fadeDuration*this.options.fadeDelay)}else{this.block();this.show()}if(this.options.escapeClose){e(document).on("keydown.modal",function(t){if(t.which==27)e.modal.close()})}if(this.options.clickClose)this.blocker.click(e.modal.close)},close:function(){this.unblock();this.hide();e(document).off("keydown.modal")},block:function(){var t=this.options.doFade?0:this.options.opacity;this.$elm.trigger(e.modal.BEFORE_BLOCK,[this._ctx()]);this.blocker=e('<div class="jquery-modal blocker"></div>').css({top:0,right:0,bottom:0,left:0,width:"100%",height:"100%",position:"fixed",zIndex:this.options.zIndex,background:this.options.overlay,opacity:t});this.$body.append(this.blocker);if(this.options.doFade){this.blocker.animate({opacity:this.options.opacity},this.options.fadeDuration)}this.$elm.trigger(e.modal.BLOCK,[this._ctx()])},unblock:function(){if(this.options.doFade){this.blocker.fadeOut(this.options.fadeDuration,function(){e(this).remove()})}else{this.blocker.remove()}},show:function(){this.$elm.trigger(e.modal.BEFORE_OPEN,[this._ctx()]);if(this.options.showClose){this.closeButton=e('<a href="#close-modal" rel="modal:close" class="close-modal '+this.options.closeClass+'">'+this.options.closeText+"</a>");this.$elm.append(this.closeButton)}this.$elm.addClass(this.options.modalClass+" current");this.center();if(this.options.doFade){this.$elm.fadeIn(this.options.fadeDuration)}else{this.$elm.show()}this.$elm.trigger(e.modal.OPEN,[this._ctx()])},hide:function(){this.$elm.trigger(e.modal.BEFORE_CLOSE,[this._ctx()]);if(this.closeButton)this.closeButton.remove();this.$elm.removeClass("current");if(this.options.doFade){this.$elm.fadeOut(this.options.fadeDuration)}else{this.$elm.hide()}this.$elm.trigger(e.modal.CLOSE,[this._ctx()])},showSpinner:function(){if(!this.options.showSpinner)return;this.spinner=this.spinner||e('<div class="'+this.options.modalClass+'-spinner"></div>').append(this.options.spinnerHtml);this.$body.append(this.spinner);this.spinner.show()},hideSpinner:function(){if(this.spinner)this.spinner.remove()},center:function(){this.$elm.css({position:"fixed",top:"54%",left:"55%",marginTop:-(this.$elm.outerHeight()/2),marginLeft:-(this.$elm.outerWidth()/2),zIndex:this.options.zIndex+1})},_ctx:function(){return{elm:this.$elm,blocker:this.blocker,options:this.options}}};e.modal.prototype.resize=e.modal.prototype.center;e.modal.close=function(e){if(!t)return;if(e)e.preventDefault();t.close();var n=t.$elm;t=null;return n};e.modal.resize=function(){if(!t)return;t.resize()};e.modal.isActive=function(){return t?true:false};e.modal.defaults={overlay:"#000",opacity:.75,zIndex:1,escapeClose:true,clickClose:true,closeText:"Close",closeClass:"",modalClass:"modal",spinnerHtml:null,showSpinner:true,showClose:true,fadeDuration:null,fadeDelay:1};e.modal.BEFORE_BLOCK="modal:before-block";e.modal.BLOCK="modal:block";e.modal.BEFORE_OPEN="modal:before-open";e.modal.OPEN="modal:open";e.modal.BEFORE_CLOSE="modal:before-close";e.modal.CLOSE="modal:close";e.modal.AJAX_SEND="modal:ajax:send";e.modal.AJAX_SUCCESS="modal:ajax:success";e.modal.AJAX_FAIL="modal:ajax:fail";e.modal.AJAX_COMPLETE="modal:ajax:complete";e.fn.modal=function(n){if(this.length===1){t=new e.modal(this,n)}return this};e(document).on("click.modal",'a[rel="modal:close"]',e.modal.close);e(document).on("click.modal",'a[rel="modal:open"]',function(t){t.preventDefault();e(this).modal()})})(jQuery)